{% extends 'container/container_base.html' %}
{% load humanize %}

{% block title %} Almuqbil | saraf_list {% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-2 text-dark">{{ page_title }}</h1>
      <p class="text-muted mb-0">{{ page_subtitle }}</p>
    </div>
    <div class="top-bar">
      <div class="top-actions">
        <button class="export-btn" onclick="exportToCSV()">
          <i class="fas fa-file-export"></i> Export CSV
        </button>
      </div>
    </div>
  </div>
  <div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-opacity-10 rounded-3 p-3 me-3">
              <i class="fas fa-users text-primary fs-3"></i>
            </div>
            <div>
              <h3 class="mb-1">{{ total_count }}</h3>
              <p class="text-muted mb-0">Total Sarafs</p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-success bg-opacity-10 rounded-3 p-3 me-3">
              <i class="fas fa-arrow-down text-success fs-3"></i>
            </div>
            <div>
              <h3 class="mb-1 text-success">AED{{ total_received_sum|floatformat:0|intcomma }}</h3>
              <p class="text-muted mb-0">Total Received</p>
            </div>
          </div>
          <div class="mt-3">
            <small class="text-success">
              <i class="fas fa-chart-line me-1"></i> All-time total
            </small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-danger bg-opacity-10 rounded-3 p-3 me-3">
              <i class="fas fa-arrow-up text-danger fs-3"></i>
            </div>
            <div>
              <h3 class="mb-1 text-danger">AED{{ total_paid_sum|floatformat:0|intcomma }}</h3>
              <p class="text-muted mb-0">Total Paid</p>
            </div>
          </div>
          <div class="mt-3">
            <small class="text-danger">
              <i class="fas fa-chart-line me-1"></i> All-time total
            </small>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-info bg-opacity-10 rounded-3 p-3 me-3">
              <i class="fas fa-scale-balanced text-info fs-3"></i>
            </div>
            <div>
              <h3
                class="mb-1 {% if net_balance_sum > 0 %}text-success{% elif net_balance_sum < 0 %}text-danger{% else %}text-secondary{% endif %}">
                AED{{ net_balance_sum|floatformat:0|intcomma }}
              </h3>
              <p class="text-muted mb-0">Net Balance</p>
            </div>
          </div>
          <div class="mt-3">
            <small
              class="{% if net_balance_sum > 0 %}text-success{% elif net_balance_sum < 0 %}text-danger{% else %}text-secondary{% endif %}">
              <i
                class="fas fa-{% if net_balance_sum > 0 %}arrow-up{% elif net_balance_sum < 0 %}arrow-down{% else %}equals{% endif %} me-1"></i>
              {% if net_balance_sum > 0 %}Company is Creditor{% elif net_balance_sum < 0 %}Company is Debtor{% else%}Perfectly Balanced{% endif %} </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <a href="{% url 'admin:containers_saraf_add' %}" class="btn btn-primary">
        <i class="fas fa-plus-circle me-2"></i> Add New Saraf
      </a>
    </div>

  </div>
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-white border-0 py-3">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Sarafs List</h5>
        <div class="text-muted small">
          {{ sarafs.start_index|default:1 }} - {{ sarafs.end_index|default:sarafs|length }} {{sarafs.paginator.count }}
        </div>
      </div>
    </div>

    <div class="card-body p-0">
      {% if sarafs %}
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4 py-3">Saraf Information</th>
              <th class="text-center py-3">Received</th>
              <th class="text-center py-3">Paid</th>
              <th class="text-center py-3">Balance</th>
              <th class="text-center py-3">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for saraf in sarafs %}
            <tr class="data-row" data-id="{{ saraf.id }}" data-name="{{ saraf.user.get_full_name|default:saraf.user }}"
              data-received="{{ saraf.total_received }}" data-paid="{{ saraf.total_paid }}"
              data-balance="{{ saraf.balance }}"
              data-status="{% if saraf.balance > 0 %}creditor{% elif saraf.balance < 0 %}debtor{% else %}balanced{% endif %}">
              <td>
                <div class="user-cell">
                  <div class="user-info">
                    <div class="user-name">{{ saraf.user.get_full_name|default:saraf.user }}</div>
                  </div>
                </div>
              </td>
              <td>
                <div class="amount-cell positive">
                  <span class="amount-value">{{ saraf.total_received|floatformat:0 }}</span>
                </div>
              </td>
              <td>
                <div class="amount-cell negative">
                  <span class="amount-value">{{ saraf.total_paid|floatformat:0 }}</span>
                </div>
              </td>
              <td>
                {% if saraf.balance > 0 %}
                <div class="amount-cell positive">
                  <span class="amount-value">{{ saraf.balance|floatformat:0 }}</span>
                </div>
                {% elif saraf.balance < 0 %} <div class="amount-cell negative">
                  <span class="amount-value">{{ saraf.balance|floatformat:0 }}</span>
      </div>
      {% else %}
      <div class="amount-cell neutral">
        <span class="amount-value">{{ saraf.balance|floatformat:0 }}</span>
      </div>
      {% endif %}
      </td>
      <td>
        <div class="actions-cell align-items-center">
          <a href="{% url 'containers:saraf_detail' saraf.id %}" class="action-link view-link" title="View">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path
                d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
            </svg>
          </a>
        </div>
      </td>
      </tr>
      {% empty %}
      <tr class="empty-row">
        <td colspan="5">
          <div class="empty-state">
            <svg class="empty-icon" width="48" height="48" viewBox="0 0 24 24">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
            </svg>
            <h3>No Sarafs Found</h3>
            <p>Start by adding your first saraf</p>
          </div>
        </td>

      </tr>
      {% endfor %}
      </tbody>
      </table>
    </div>
    {% else %}

    <!-- Empty State -->
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="fas fa-user-friends fa-4x text-light"></i>
      </div>
      <h4 class="text-muted mb-3">No Sarafs Found</h4>
      <p class="text-muted mb-4">Start by adding your first saraf account to the system.</p>
      <a href="{% url 'admin:containers_saraf_add' %}" class="btn btn-primary px-4 py-2">
        <i class="fas fa-plus-circle me-2"></i> Add First Saraf
      </a>
    </div>
    {% endif %}
  </div>
</div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>
{% endblock %}