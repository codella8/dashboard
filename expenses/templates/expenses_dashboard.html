<!-- expenses/templates/expenses/expenses_dashboard.html -->
{% extends 'base.html' %}
{% load humanize %}
{% load static %}

{% block title %}Expenses Dashboard - Financial Analytics{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card animate-fade-in">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0"><i class="fas fa-chart-line me-3"></i>Financial Dashboard</h2>
                        <p class="mb-0 mt-2 opacity-75">Comprehensive expense analytics and insights</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="badge bg-light text-dark me-3">
                            <i class="fas fa-clock me-1"></i>
                            {{ today|date:"F d, Y" }}
                        </span>
                        <button class="btn btn-light" onclick="window.print()">
                            <i class="fas fa-print me-1"></i> Print Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section animate-fade-in">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h4 class="filter-title"><i class="fas fa-filter me-2"></i>Filter Expenses</h4>
                <form method="get" class="row g-3">
                    <div class="col-md-4">
                        <div class="date-input-group">
                            <i class="fas fa-calendar-alt"></i>
                            <input type="date" class="form-control" id="start_date" name="start_date"
                                   value="{{ filter.start_date_str }}" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="date-input-group">
                            <i class="fas fa-calendar-alt"></i>
                            <input type="date" class="form-control" id="end_date" name="end_date"
                                   value="{{ filter.end_date_str }}" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-chart-bar me-2"></i>Update Dashboard
                        </button>
                    </div>
                </form>
            </div>
            <div class="col-md-4 text-end">
                <div class="d-flex flex-column align-items-end">
                    <span class="text-muted mb-1">
                        <i class="fas fa-info-circle me-1"></i>
                        Period: {{ filter.start_date|date:"M d" }} - {{ filter.end_date|date:"M d, Y" }}
                    </span>
                    <span class="badge bg-primary">
                        {{ metadata.days_in_period }} days analyzed
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Overview Statistics -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stat-card stat-card-primary animate-fade-in" style="animation-delay: 0.1s">
                <div class="text-center">
                    <div class="stat-icon text-primary">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-value">
                        {{ overview.total_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                    </div>
                    <div class="stat-label">Total Expenses</div>
                    <div class="stat-change mt-2">
                        {% if analysis.trend %}
                            {% if analysis.trend.direction == 'up' %}
                                <span class="trend-up"><i class="fas fa-arrow-up me-1"></i>{{ analysis.trend.growth_rate }}% growth</span>
                            {% elif analysis.trend.direction == 'down' %}
                                <span class="trend-down"><i class="fas fa-arrow-down me-1"></i>{{ analysis.trend.growth_rate }}% decline</span>
                            {% else %}
                                <span class="trend-stable"><i class="fas fa-minus me-1"></i>Stable</span>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-card stat-card-success animate-fade-in" style="animation-delay: 0.2s">
                <div class="text-center">
                    <div class="stat-icon text-success">
                        <i class="fas fa-receipt"></i>
                    </div>
                    <div class="stat-value">{{ overview.total_count }}</div>
                    <div class="stat-label">Number of Expenses</div>
                    <div class="small text-muted mt-2">
                        {{ analysis.frequency.avg_expenses_per_day|floatformat:1 }} per day
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-card stat-card-info animate-fade-in" style="animation-delay: 0.3s">
                <div class="text-center">
                    <div class="stat-icon text-info">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="stat-value">
                        {{ analysis.frequency.avg_amount_per_day|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                    </div>
                    <div class="stat-label">Daily Average</div>
                    <div class="small text-muted mt-2">
                        {{ analysis.frequency.days_with_expenses }}/{{ analysis.frequency.days_in_period }} days
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-card stat-card-warning animate-fade-in" style="animation-delay: 0.4s">
                <div class="text-center">
                    <div class="stat-icon text-warning">
                        <i class="fas fa-cube"></i>
                    </div>
                    <div class="stat-value">{{ analysis.quantity.stats.total_quantity|floatformat:0|intcomma }}</div>
                    <div class="stat-label">Total Quantity</div>
                    <div class="small text-muted mt-2">
                        Avg: {{ analysis.quantity.stats.avg_quantity|floatformat:1 }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Analysis Row -->
    <div class="row mb-4">
        <!-- Category Analysis -->
        <div class="col-lg-6">
            <div class="card animate-fade-in" style="animation-delay: 0.5s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-tags me-2"></i>Category Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-end">Count</th>
                                    <th class="text-end">%</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for category in analysis.categories %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <span class="badge-custom badge-primary-custom">
                                                    <i class="fas fa-folder me-1"></i>
                                                </span>
                                            </div>
                                            <div>
                                                <div class="fw-bold">{{ category.name }}</div>
                                                <small class="text-muted">{{ category.description }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold">
                                        {{ category.total_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end">
                                        <span class="badge bg-light text-dark">{{ category.count }}</span>
                                    </td>
                                    <td class="text-end">
                                        <div class="d-flex align-items-center justify-content-end">
                                            <span class="me-2">{{ category.percentage|floatformat:1 }}%</span>
                                            <div class="progress-custom" style="width: 60px;">
                                                <div class="progress-bar-custom bg-primary" ></div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="empty-state">
                                        <i class="fas fa-chart-pie"></i>
                                        <p class="mt-2">No category data available</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Method Analysis -->
        <div class="col-lg-6">
            <div class="card animate-fade-in" style="animation-delay: 0.6s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-credit-card me-2"></i>Payment Methods</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-end">Count</th>
                                    <th class="text-end">Avg</th>
                                    <th class="text-end">%</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for payment in analysis.payment_methods %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if payment.method == "cash" %}
                                                <span class="badge-custom badge-success-custom me-2">
                                                    <i class="fas fa-money-bill-wave me-1"></i>
                                                </span>
                                            {% elif payment.method == "bank" %}
                                                <span class="badge-custom badge-primary-custom me-2">
                                                    <i class="fas fa-university me-1"></i>
                                                </span>
                                            {% else %}
                                                <span class="badge-custom badge-warning-custom me-2">
                                                    <i class="fas fa-credit-card me-1"></i>
                                                </span>
                                            {% endif %}
                                            <span class="fw-bold">{{ payment.display_name }}</span>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold">
                                        {{ payment.total_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end">{{ payment.count }}</td>
                                    <td class="text-end">
                                        {{ payment.avg_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end">
                                        <span class="badge bg-light text-dark">{{ payment.percentage|floatformat:1 }}%</span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="empty-state">
                                        <i class="fas fa-credit-card"></i>
                                        <p class="mt-2">No payment method data available</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Analysis Row -->
    <div class="row mb-4">
        <!-- Recent Expenses -->
        <div class="col-lg-8">
            <div class="card animate-fade-in" style="animation-delay: 0.7s">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Expenses</h5>
                    <div>
                        <a href="{% url 'admin:expenses_expense_add' %}" class="btn btn-sm btn-primary">
                            <i class="fas fa-plus me-1"></i> Add New
                        </a>
                        <a href="{% url 'expenses:search_expenses' %}" class="btn btn-sm btn-outline-primary ms-2">
                            <i class="fas fa-search me-1"></i> Advanced Search
                        </a>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-custom mb-0">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th class="text-end">Qty</th>
                                    <th class="text-end">Unit Price</th>
                                    <th class="text-end">Total</th>
                                    <th>Payment</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for expense in expenses.recent %}
                                <tr class="custom-tooltip" data-tooltip="{{ expense.description }}">
                                    <td>
                                        <span class="badge bg-light text-dark">
                                            {{ expense.date|date:"M d" }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{% url 'expenses:expense_detail' expense.id %}" class="text-decoration-none">
                                            {{ expense.title|truncatechars:30 }}
                                        </a>
                                    </td>
                                    <td>
                                        <a href="{% url 'expenses:category_detail' expense.category_id %}" 
                                           class="badge bg-info text-decoration-none">
                                            {{ expense.category }}
                                        </a>
                                    </td>
                                    <td class="text-end">{{ expense.quantity }}</td>
                                    <td class="text-end">
                                        {{ expense.unit_price|floatformat:2 }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end fw-bold text-success">
                                        {{ expense.total_amount|floatformat:2 }}{{ overview.currency_symbol }}
                                    </td>
                                    <td>
                                        {% if expense.payment_code == "cash" %}
                                            <span class="badge-custom badge-success-custom">
                                                <i class="fas fa-money-bill-wave me-1"></i>Cash
                                            </span>
                                        {% elif expense.payment_code == "bank" %}
                                            <span class="badge-custom badge-primary-custom">
                                                <i class="fas fa-university me-1"></i>Bank
                                            </span>
                                        {% else %}
                                            <span class="badge-custom badge-warning-custom">
                                                <i class="fas fa-credit-card me-1"></i>Card
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7" class="empty-state">
                                        <i class="fas fa-receipt"></i>
                                        <p class="mt-2">No expenses found in the selected period</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="col-lg-4">
            <div class="card animate-fade-in" style="animation-delay: 0.8s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Quick Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-custom">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-dollar-sign text-success me-2"></i>
                                Average Expense
                            </span>
                            <span class="fw-bold">
                                {{ overview.avg_amount_per_expense|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                            </span>
                        </div>
                        
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-calendar-check text-primary me-2"></i>
                                Expense Frequency
                            </span>
                            <span class="fw-bold">
                                {{ analysis.frequency.expense_frequency_percentage|floatformat:1 }}%
                            </span>
                        </div>
                        
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-file-alt text-info me-2"></i>
                                Descriptions Provided
                            </span>
                            <span class="fw-bold">
                                {{ analysis.description.description_percentage|floatformat:1 }}%
                            </span>
                        </div>
                        
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-chart-line text-warning me-2"></i>
                                Largest Expense
                            </span>
                            <span class="fw-bold text-success">
                                {% if expenses.largest %}
                                    {{ expenses.largest.quantity|floatformat:2 }} Ã— 
                                    {{ expenses.largest.unit_price|floatformat:2 }}{{ overview.currency_symbol }}
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price Distribution -->
            <div class="card mt-4 animate-fade-in" style="animation-delay: 0.9s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Price Distribution</h5>
                </div>
                <div class="card-body">
                    {% for range_name, count in analysis.price.ranges.items %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-capitalize">{{ range_name|replace:"_, " }}</span>
                            <span class="fw-bold">{{ count }}</span>
                        </div>
                        {% widthratio count overview.total_count 100 as percentage %}
                        <div class="progress-custom">
                            <div class="progress-bar-custom bg-primary"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Analysis -->
    <div class="row">
        <!-- Monthly Trend -->
        <div class="col-lg-6">
            <div class="card animate-fade-in" style="animation-delay: 1.0s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Monthly Trend (12 Months)</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-end">Count</th>
                                    <th class="text-end">Avg</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for month in analysis.monthly|slice:"-6:" %}
                                <tr>
                                    <td>{{ month.month_name }}</td>
                                    <td class="text-end fw-bold">
                                        {{ month.total_amount|floatformat:0|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end">{{ month.count }}</td>
                                    <td class="text-end">
                                        {{ month.avg_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekday Analysis -->
        <div class="col-lg-6">
            <div class="card animate-fade-in" style="animation-delay: 1.1s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-calendar-week me-2"></i>Weekday Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th class="text-end">Amount</th>
                                    <th class="text-end">Count</th>
                                    <th class="text-end">Avg</th>
                                    <th class="text-end">%</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for day in analysis.weekdays %}
                                <tr>
                                    <td>{{ day.name }}</td>
                                    <td class="text-end fw-bold">
                                        {{ day.total_amount|floatformat:0|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end">{{ day.count }}</td>
                                    <td class="text-end">
                                        {{ day.avg_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                                    </td>
                                    <td class="text-end">
                                        <span class="badge bg-light text-dark">{{ day.percentage|floatformat:1 }}%</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recipients and Quantity Analysis -->
    <div class="row mt-4">
        <!-- Top Recipients -->
        <div class="col-lg-6">
            <div class="card animate-fade-in" style="animation-delay: 1.2s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-users me-2"></i>Top Recipients</h5>
                </div>
                <div class="card-body">
                    {% if analysis.recipients %}
                    <div class="list-group list-group-custom">
                        {% for recipient in analysis.recipients %}
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-user-circle text-primary me-2"></i>
                                        {{ recipient.name|truncatechars:30 }}
                                    </h6>
                                    <small class="text-muted">
                                        {{ recipient.first_payment|date:"M d" }} - {{ recipient.last_payment|date:"M d, Y" }}
                                    </small>
                                </div>
                                <span class="badge bg-light text-dark">{{ recipient.count }} payments</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="fw-bold text-success">
                                    {{ recipient.total_amount|floatformat:2|intcomma }}{{ overview.currency_symbol }}
                                </span>
                                <span class="badge bg-info">{{ recipient.percentage|floatformat:1 }}%</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p class="mt-2">No recipient data available</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Quantity Analysis -->
        <div class="col-lg-6">
            <div class="card animate-fade-in" style="animation-delay: 1.3s">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Quantity Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 mb-4">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">Min Quantity</div>
                                <div class="h4 fw-bold text-primary">
                                    {{ analysis.quantity.stats.min_quantity|floatformat:2 }}
                                </div>
                            </div>
                        </div>
                        <div class="col-6 mb-4">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">Max Quantity</div>
                                <div class="h4 fw-bold text-success">
                                    {{ analysis.quantity.stats.max_quantity|floatformat:2 }}
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">Avg Quantity</div>
                                <div class="h4 fw-bold text-info">
                                    {{ analysis.quantity.stats.avg_quantity|floatformat:2 }}
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">Total Quantity</div>
                                <div class="h4 fw-bold text-warning">
                                    {{ analysis.quantity.stats.total_quantity|floatformat:0|intcomma }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <h6 class="mb-3">Quantity Ranges:</h6>
                    {% for range_name, count in analysis.quantity.ranges.items %}
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-capitalize">{{ range_name|replace:"_, " }}</span>
                        <div class="d-flex align-items-center">
                            <span class="me-3">{{ count }}</span>
                            {% widthratio count overview.total_count 100 as percentage %}
                            <div class="progress-custom" style="width: 100px;">
                                <div class="progress-bar-custom bg-warning"></div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card animate-fade-in" style="animation-delay: 1.4s">
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-sync-alt text-primary me-2"></i>
                                <div>
                                    <div class="small text-muted">Last Updated</div>
                                    <div class="fw-bold">{{ metadata.creation_times.last_created|date:"H:i:s" }}</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-database text-success me-2"></i>
                                <div>
                                    <div class="small text-muted">Data Points</div>
                                    <div class="fw-bold">{{ overview.total_count }} records</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-chart-area text-warning me-2"></i>
                                <div>
                                    <div class="small text-muted">Reporting Period</div>
                                    <div class="fw-bold">{{ metadata.days_in_period }} days</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize date picker validation
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');
        
        if (startDateInput && endDateInput) {
            // Set min/max dates for validation
            startDateInput.max = endDateInput.value;
            endDateInput.min = startDateInput.value;
            
            startDateInput.addEventListener('change', function () {
                endDateInput.min = this.value;
                endDateInput.max = new Date().toISOString().split('T')[0];
            });
            
            endDateInput.addEventListener('change', function () {
                startDateInput.max = this.value;
            });
        }
        
        // Add animation to table rows on hover
        const tableRows = document.querySelectorAll('.table-custom tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', function () {
                this.style.transition = 'transform 0.2s ease';
                this.style.transform = 'scale(1.01)';
            });
            
            row.addEventListener('mouseleave', function () {
                this.style.transform = 'scale(1)';
            });
        });

        
        
        // Print report with better formatting
        window.printReport = function() {
            const originalTitle = document.title;
            document.title = 'Expenses Report - ' + new Date().toLocaleDateString();
            window.print();
            document.title = originalTitle;
        };
        
        // Tooltip initialization
        const tooltips = document.querySelectorAll('.custom-tooltip');
        tooltips.forEach(tooltip => {
            tooltip.addEventListener('mouseenter', function() {
                this.style.position = 'relative';
            });
        });
        
        // Progress bar animation
        const progressBars = document.querySelectorAll('.progress-bar-custom');
        progressBars.forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0';
            setTimeout(() => {
                bar.style.width = width;
            }, 300);
        });
    });
</script>
{% endblock %}